# Pre-commit hooks: Automated checks before each commit
# Install: pre-commit install
# Run manually: pre-commit run --all-files

repos:
  # Basic checks (trailing whitespace, YAML validity, etc.)
  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v4.5.0
    hooks:
      - id: trailing-whitespace
        name: Trim trailing whitespace
      - id: end-of-file-fixer
        name: Fix end of file
      - id: check-yaml
        name: Check YAML syntax
        args: ['--unsafe']
      - id: check-json
        name: Check JSON syntax
        exclude: |
          (?x)^(
            .devcontainer/devcontainer\.json
          )$
      - id: check-toml
        name: Check TOML syntax
      - id: check-merge-conflict
        name: Check for merge conflicts
      - id: detect-private-key
        name: Detect private keys

  # Prettier: Format JavaScript, TypeScript, JSON, Markdown, YAML
  - repo: https://github.com/pre-commit/mirrors-prettier
    rev: v3.1.0
    hooks:
      - id: prettier
        name: Prettier (JS, TS, JSON, MD, YAML)
        types_or:
          - javascript
          - jsx
          - ts
          - tsx
          - json
          - markdown
          - yaml
        exclude: |
          (?x)^(
            packages/backend/.*|
            old/.*
          )$

  # Ruff: Lint and format Python
  - repo: https://github.com/astral-sh/ruff-pre-commit
    rev: v0.1.11
    hooks:
      - id: ruff
        name: Ruff (lint Python)
        args: ['check', '--fix']
      - id: ruff-format
        name: Ruff (format Python)

  # mypy: Type checking for Python
  - repo: https://github.com/pre-commit/mirrors-mypy
    rev: v1.8.0
    hooks:
      - id: mypy
        name: mypy (type check Python)
        args: ['--strict']
        files: ^packages/backend/src/lumehaven/
        additional_dependencies:
          - pydantic>=2.5.0
          - pydantic-settings>=2.1.0
          - fastapi>=0.109.0
          - httpx>=0.26.0
          - sse-starlette>=2.0.0

# Configuration options
default_language_version:
  python: python3.14

fail_fast: false # Run all hooks, don't stop at first failure
